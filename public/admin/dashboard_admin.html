<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo</title>
<link rel="stylesheet" href="/css/style.css">

<style>
    body {
        margin: 0;
        background: #f3f5f9;
        font-family: Arial, sans-serif;
    }

    /* HEADER */
    .top-header {
        width: 100%;
        height: 70px;
        background: #ffffff;
        border-bottom: 1px solid #dcdcdc;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 25px;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 10;
    }
    .top-header img {
        height: 42px;
    }
    .logout-btn {
        background: #f3c400;
        color: #000;
        border: none;
        padding: 10px 18px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }

    /* SIDEBAR */
    #sidebar {
        position: fixed;
        top: 70px;
        left: 0;
        width: 220px;
        bottom: 0;
        background: #062345;
        color: #fff;
        padding-top: 20px;
    }

    /* MAIN */
    .main {
        margin-left: 240px;
        margin-top: 100px;
        padding: 20px;
    }

    h1 {
        font-size: 28px;
        color: #062345;
        margin-bottom: 25px;
        font-weight: bold;
    }

    /* CARDS */
    .top-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 25px;
    }

    .top-card {
        background: #ffffff;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    .top-card .small {
        color: #666;
        font-size: 14px;
    }

    .top-card h2 {
        margin-top: 10px;
        font-size: 26px;
        color: #062345;
    }

    /* CONTENT CARD */
    .card {
        background: #ffffff;
        border-radius: 14px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    h3 {
        margin-top: 0;
        color: #062345;
        margin-bottom: 20px;
        font-size: 22px;
        font-weight: bold;
    }

    /* TABLE */
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 15px;
    }

    th {
        background: #f0f0f0;
        padding: 12px;
        text-align: left;
        font-weight: bold;
        border-bottom: 1px solid #ddd;
    }

    td {
        padding: 10px;
        border-bottom: 1px solid #eee;
    }
</style>
</head>

<body>

<script>
const uStr = localStorage.getItem("usuario");
let u = null;
try { u = uStr ? JSON.parse(uStr) : null; } catch(e){ u = null; }
if (!u) {
  window.location.href = "/";
} else if (u.role !== "financeiro" && u.role !== "admin") {
  window.location.href = "/colaborador/dashboard.html";
}
</script>

<!-- HEADER NOVO -->
<div class="top-header">
    <img src="/img/logo.png">
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<!-- SIDEBAR -->
<div id="sidebar"></div>

<!-- MAIN -->
<div class="main">
    <h1>Painel Administrativo</h1>

    <div class="top-cards">
        <div class="top-card"><div class="small">Recebíveis Pendentes</div><h2 id="rpend"></h2></div>
        <div class="top-card"><div class="small">Recebíveis Pagos</div><h2 id="rpago"></h2></div>
        <div class="top-card"><div class="small">Empréstimos Pendentes</div><h2 id="epend"></h2></div>
        <div class="top-card"><div class="small">Empréstimos Aprovados</div><h2 id="eaprov"></h2></div>
    </div>

    <div class="card">
        <h3>Últimos Recebíveis</h3>
        <table id="receb"></table>
    </div>
</div>

<script>
fetch('/admin/sidebar_admin.html').then(r=>r.text()).then(h=>sidebar.innerHTML=h);

function fmt(n){return "R$ "+Number(n||0).toLocaleString("pt-BR",{minimumFractionDigits:2});}
function logout(){localStorage.clear();location="/";}

async function load(){
  let rec = await fetch("/api/recebiveis").then(r=>r.json());
  let emp = await fetch("/api/emprestimos").then(r=>r.json());

  let pendR = rec.filter(r=>r.status=="Pendente");
  let pagoR = rec.filter(r=>r.status=="Pago");
  let pendE = emp.filter(e=>e.status=="Em análise");
  let aprE  = emp.filter(e=>e.status=="Aprovado");

  rpend.innerText = fmt(pendR.reduce((t,x)=>t+Number(x.valor),0));
  rpago.innerText = fmt(pagoR.reduce((t,x)=>t+Number(x.valor),0));
  epend.innerText = pendE.length;
  eaprov.innerText = aprE.length;

  let html = "<tr><th>ID</th><th>Usuário</th><th>Valor</th><th>Status</th></tr>";
  rec.slice(0,10).forEach(r=>{
    html+=`<tr><td>${r.id}</td><td>${r.nome}</td><td>${fmt(r.valor)}</td><td>${r.status}</td></tr>`;
  });
  receb.innerHTML = html;
}
load();
</script>
</body>
</html>
