<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Alterar Receb√≠veis - CoelhoLog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  :root {
    --azul-topbar: #062243;
    --azul-sidebar: #04152b;
    --amarelo: #ffc81a;
    --cinza-fundo: #f5f7fb;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: Arial, sans-serif;
    background: var(--cinza-fundo);
    color: #0b2145;
  }

  /* TOPBAR */
  .topbar {
    position: sticky;
    top: 0;
    height: 64px;
    background: var(--azul-topbar);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 32px;
    z-index: 1000;
  }

  .topbar-logo {
    height: 38px;
  }

  .btn-logout {
    background: var(--amarelo);
    border: none;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
  }

  /* LAYOUT */
  .layout {
    display: flex;
    min-height: calc(100vh - 64px);
  }

  /* SIDEBAR */
  .sidebar {
    width: 230px;
    background: var(--azul-sidebar);
    padding: 24px 12px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    color: white;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    font-size: 15px;
    color: #dbe4ff;
    text-decoration: none;
    border-radius: 8px;
    transition: 0.2s;
  }

  .nav-link:hover {
    background: rgba(255,255,255,0.12);
    color: #fff;
  }

  .icon {
    font-size: 18px;
  }

  .main-content {
    flex: 1;
    padding: 32px;
  }

  h1 {
    margin-bottom: 16px;
    font-size: 24px;
    font-weight: 600;
  }

  /* FORMULARIO */
  .box {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    max-width: 600px;
  }

  label {
    font-weight: bold;
    margin-top: 14px;
    display: block;
  }

  input, select {
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #c7cdda;
    font-size: 15px;
  }

  button {
    margin-top: 22px;
    background: var(--azul-topbar);
    color: white;
    padding: 12px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 15px;
    font-weight: bold;
    width: 100%;
  }

  button:hover {
    background: #071d38;
  }

</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <img src="/img/logo.png" class="topbar-logo">
  <button class="btn-logout" onclick="logout()">Logout</button>
</header>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <a class="nav-link" href="/admin/dashboard_admin.html"><span class="icon">üìä</span>Dashboard</a>
    <a class="nav-link" href="/admin/alterar_recebiveis.html"><span class="icon">‚úèÔ∏è</span>Alterar Receb√≠veis</a>
    <a class="nav-link" href="/admin/alterar_emprestimos.html"><span class="icon">üí≥</span>Alterar Empr√©stimos</a>
    <a class="nav-link" href="/admin/criar_colaborador.html"><span class="icon">üë§</span>Criar Colaborador</a>
    <a class="nav-link" href="/admin/lancar_recebiveis.html"><span class="icon">‚ûï</span>Lan√ßar Receb√≠vel</a>
    <a class="nav-link" href="/admin/todos_emprestimos.html"><span class="icon">üìö</span>Todos Empr√©stimos</a>
  </aside>

  <!-- CONTE√öDO -->
  <main class="main-content">
    <h1>Alterar Receb√≠veis</h1>

    <div class="box">

      <label>ID</label>
      <input id="id" readonly>

      <label>Nome</label>
      <input id="nome" readonly>

      <label>Valor</label>
      <input id="valor" type="number">

      <label>Data</label>
      <input id="data" type="date">

      <label>Status</label>
      <select id="status">
        <option value="Pendente">Pendente</option>
        <option value="Pago">Pago</option>
      </select>

      <button onclick="salvar()">Salvar Altera√ß√µes</button>
    </div>
  </main>

</div>

<script>
/* PROTE√á√ÉO */
const uStr = localStorage.getItem("usuario");
let u = null;
try{ u = uStr ? JSON.parse(uStr) : null; }catch(e){ u = null; }

if(!u){
  window.location.href="/";
}else if(u.role!=="financeiro" && u.role!=="admin"){
  window.location.href="/colaborador/dashboard.html";
}

/* LOGOUT */
function logout(){
  localStorage.clear();
  window.location.href="/";
}

/* CARREGAR DADOS NA P√ÅGINA */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

async function carregar(){
  const r = await fetch("/api/recebiveis/" + id);
  const dados = await r.json();

  document.getElementById("id").value = dados.id;
  document.getElementById("nome").value = dados.nome;
  document.getElementById("valor").value = dados.valor;

  if(dados.data){
    document.getElementById("data").value = dados.data.split(" ")[0];
  }

  document.getElementById("status").value = dados.status;
}

/* SALVAR */
async function salvar(){
  const body = {
    valor: document.getElementById("valor").value,
    data: document.getElementById("data").value,
    status: document.getElementById("status").value
  };

  await fetch("/api/recebiveis/" + id, {
    method:"PUT",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(body)
  });

  alert("Receb√≠vel atualizado com sucesso!");
}

carregar();
</script>

</body>
</html>
