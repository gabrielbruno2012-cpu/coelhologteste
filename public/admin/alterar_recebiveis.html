<html>
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo - CoelhoLog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/style.css">

<style>
    /* CARD PADR√ÉO */
    .card-wrapper {
        max-width: 900px;
        background: #fff;
        padding: 30px;
        border-radius: 16px;
        margin: 40px auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h1 {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 25px;
        color: #0A2342;
    }

    .table th {
        background: #0A2342;
        color: white;
        padding: 10px;
        text-align: left;
    }

    .table td {
        background: #f9f9f9;
        padding: 10px;
    }

    .input {
        width: 100%;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #021835;
    }

    .btn-save {
        background: #0A2342;
        color: white;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        border: none;
    }

    /* Topbar coerente com o restante */
    .topbar {
        width: 100%;
        height: 60px;
        background: #0A2342;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 25px;
    }

    .topbar img {
        height: 42px;
    }

    .logout-btn {
        background: #FFC400;
        border: none;
        padding: 7px 18px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }

    .main {
        margin-left: 260px;
        padding: 20px;
    }
</style>

</head>
<body>

<script>
const uStr = localStorage.getItem("usuario");
let u = null;
try { u = uStr ? JSON.parse(uStr) : null; } catch(e){ u = null; }

if (!u) {
  window.location.href = "/";
} else if (u.role !== "financeiro" && u.role !== "admin") {
  window.location.href = "/colaborador/dashboard.html";
}
</script>

<!-- üîµ TOPBAR AZUL COM LOGO -->
<div class="topbar">
    <img src="/img/logo.png">
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<!-- SIDEBAR -->
<div id="sidebar"></div>

<!-- CONTE√öDO -->
<div class="main">

    <div class="card-wrapper">
        <h1>Alterar Receb√≠veis</h1>

        <table class="table" id="lista"></table>
    </div>

</div>

<script>
fetch('/admin/sidebar_admin.html').then(r=>r.text()).then(h=>sidebar.innerHTML=h);
function logout(){localStorage.clear();location="/";}
function fmt(n){return "R$ "+Number(n||0).toLocaleString("pt-BR",{minimumFractionDigits:2});}

async function load(){
 let rec = await fetch('/api/recebiveis').then(r=>r.json());
 rec = rec.filter(r=>r.status=="Pendente");

 let html = `
   <tr>
     <th>ID</th>
     <th>Usu√°rio</th>
     <th>Data</th>
     <th>Valor</th>
     <th>Tipo</th>
     <th>Status</th>
     <th>A√ß√£o</th>
   </tr>
 `;

 rec.forEach(r=>{
   html += `
     <tr>
       <td>${r.id}</td>
       <td>${r.nome}</td>

       <td><input type="date" class="input" id="data${r.id}" value="${r.data || ''}"></td>

       <td><input type="number" class="input" step="0.01" id="valor${r.id}" value="${r.valor || ''}"></td>

       <td><input class="input" id="tipo${r.id}" value="${r.tipo || ''}"></td>

       <td>
         <select id="s${r.id}" class="input">
           <option ${r.status=='Pendente'?'selected':''}>Pendente</option>
           <option ${r.status=='Pago'?'selected':''}>Pago</option>
         </select>
       </td>

       <td>
         <button class="btn-save" onclick="save(${r.id})">Salvar</button>
       </td>
     </tr>
   `;
 });

 lista.innerHTML = html;
}

async function save(id){
 let data  = document.getElementById("data"+id).value;
 let valor = document.getElementById("valor"+id).value;
 let tipo  = document.getElementById("tipo"+id).value;
 let st    = document.getElementById("s"+id).value;

 await fetch("/api/recebiveis/"+id,{
   method:"PUT",
   headers:{"Content-Type":"application/json"},
   body: JSON.stringify({ data, valor, tipo, status: st })
 });

 alert("Atualizado!");
 load();
}

load();
</script>

</body>
</html>
