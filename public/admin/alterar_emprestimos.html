
<html><head>
<link rel="stylesheet" href="/css/style.css">
</head><body>
<div id="sidebar"></div>
<div class="main">
 <div class="header-right"><button class="btn" onclick="logout()">Logout"></button></div>
 <h1>Alterar Empréstimos</h1>
 <table class="table" id="lista"></table>
</div>

<script>
fetch('/admin/sidebar_admin.html').then(r=>r.text()).then(h=>sidebar.innerHTML=h);
function logout(){localStorage.clear();location="/";}
async function load(){
 let emp = await fetch('/api/emprestimos').then(r=>r.json());
 emp = emp.filter(e=>e.status=="Em análise");
 let html="<tr><th>ID</th><th>Usuário</th><th>Valor</th><th>Status</th><th>Ação</th></tr>";
 emp.forEach(e=>{
   html+=`<tr>
     <td>${e.id}</td>
     <td>${e.nome}</td>
     <td>${e.valor}</td>
     <td><select id="st${e.id}"><option>Em análise</option><option>Aprovado</option><option>Negado</option></select></td>
     <td><button class="btn" onclick="save(${e.id})">Salvar</button></td>
   </tr>`;
 });
 lista.innerHTML=html;
}
async function save(id){
 let st=document.getElementById("st"+id).value;
 await fetch("/api/emprestimos/"+id,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:st})});
 alert("Atualizado!");
 load();
}
load();
</script>
</body></html>
